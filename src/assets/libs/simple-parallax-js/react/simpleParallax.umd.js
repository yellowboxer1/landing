(function(e,l){typeof exports=="object"&&typeof module<"u"?module.exports=l(require("react")):typeof define=="function"&&define.amd?define(["react"],l):(e=typeof globalThis<"u"?globalThis:e||self,e.MyReactLibrary=l(e.React))})(this,function(e){"use strict";class l{constructor(){this.callbacks=new Set,this.animationFrameId=null}static getInstance(){return l.instance||(l.instance=new l),l.instance}register(n){this.callbacks.add(n),this.animationFrameId===null&&this.start()}unregister(n){this.callbacks.delete(n),this.callbacks.size===0&&this.animationFrameId!==null&&this.stop()}start(){const n=()=>{this.callbacks.forEach(s=>s()),this.animationFrameId=requestAnimationFrame(n)};this.animationFrameId=requestAnimationFrame(n)}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}}const I=l.getInstance(),M=t=>{const[n,s]=e.useState(0),[i,o]=e.useState(!1),a=e.useRef(null),r=e.useCallback(()=>{a.current&&s(a.current.height)},[]);return e.useEffect(()=>{const f=()=>{o(!0),r()},u=a.current;return u&&(u.complete?f():u.addEventListener("load",f)),window.addEventListener("resize",r),()=>{u&&u.removeEventListener("load",f),window.removeEventListener("resize",r)}},[t,r]),[a,n,i]},H=(t,n)=>t*n-t,L=(t,n)=>Math.ceil(t/100*n-n/2),P=(t,n)=>{const{top:s,height:i}=t,o=-i,a=n;if(s<o)return 0;if(s>a)return 100;const r=(s-o)/(a-o)*100;return Math.min(Math.max(r,0),100)},k=(t,n)=>{switch(n){case"up":return`0, ${t}px, 0`;case"right":return`${-t}px, 0, 0`;case"down":return`0, ${-t}px, 0`;case"left":return`${t}px, 0, 0`;case"up left":return`${t}px, ${t}px, 0`;case"up right":return`${-t}px, ${t}px, 0`;case"down left":return`${t}px, ${-t}px, 0`;case"down right":return`${-t}px, ${-t}px, 0`;default:return`0, ${t}px, 0`}},z=()=>{const[t,n]=e.useState(null);return e.useEffect(()=>{const s=()=>{n(window.innerHeight)};if(typeof window<"u")return n(window.innerHeight),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),t},A=({isLoaded:t,imageHeight:n,scale:s,boundingClientRect:i,orientation:o,maxTransition:a})=>{const[r,f]=e.useState(0),[u,w]=e.useState(0),[p,S]=e.useState(""),[g,x]=e.useState(0),h=z();return e.useEffect(()=>{if(!t)return;const c=H(n,s);f(c)},[t,n,s]),e.useEffect(()=>{if(!t||!h||!i)return;let c=P(i,h);a&&(c=Math.min(c,100-a)),x(c)},[t,i,h]),e.useEffect(()=>{const c=L(g,r);w(c)},[g,r]),e.useEffect(()=>{const c=k(u,o);S(c)},[u,o]),p},N=(t={})=>{const[n,s]=e.useState(!1),i=e.useRef(null);return e.useEffect(()=>{const o=new IntersectionObserver(r=>{const[f]=r;f&&(f.isIntersecting?s(!0):s(!1))},{...t}),{current:a}=i;return a&&o.observe(a),()=>{a&&o.unobserve(a)}},[t]),[i,n]},j=()=>{const[t,n]=e.useState(!1);return e.useEffect(()=>{if(typeof window>"u")return;const s=window.matchMedia("(prefers-reduced-motion: reduce)");n(s.matches);const i=o=>{n(o.matches)};return s.addEventListener("change",i),()=>{s.removeEventListener("change",i)}},[]),t};var q="/Users/geoffrey/Desktop/perso/simpleParallax.js/src/react/index.tsx";return({delay:t=.4,orientation:n="up",scale:s=1.4,overflow:i=!1,transition:o="cubic-bezier(0,0,0,1)",maxTransition:a=null,children:r})=>{var F;const f=n??"up",u=s??1.2,w=(F=r==null?void 0:r.props)==null?void 0:F.src,[p,S]=e.useState(!1),[g,x]=e.useState(0),[h,c]=e.useState(null),[B,$]=e.useState(""),[G,y]=e.useState(""),[V,O]=e.useState(!1),d=j(),[E,W,Y]=M(w),[D,v]=N({root:null,rootMargin:"0px",threshold:Array.from(Array(101).keys(),m=>m/100)}),T=A({isLoaded:Y,imageHeight:W,scale:u,boundingClientRect:h,orientation:f,maxTransition:a}),b=e.useCallback(()=>{var m;if(!(!v&&p||d)&&(window.scrollY!==g||!p)){const C=(m=E.current)==null?void 0:m.getBoundingClientRect();C&&c(C),p||(S(!0),setTimeout(()=>{O(!0)},50)),x(window.scrollY)}},[g,v,E,p,d]);e.useEffect(()=>{if(d){$("");return}let m=`translate3d(${T})`;i||(m+=` scale(${u})`),$(m)},[T,u,i,d]),e.useEffect(()=>{if(!o||!t||!V||d){y("");return}y(`transform ${t}s ${o}`)},[o,t,V,d]),e.useEffect(()=>(d||I.register(b),()=>{I.unregister(b)}),[b,d]);const Q=e.isValidElement(r)?e.cloneElement(r,{style:{...r.props.style??{},transform:B,willChange:d?"auto":"transform",transition:G},ref:E}):null;return e.createElement("div",{ref:D,style:{overflow:i?"visible":"hidden"},__self:void 0,__source:{fileName:q,lineNumber:111,columnNumber:5}},Q)}});
